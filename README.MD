# Product Tracker with Crop/Zoom - Guide

## ğŸ¯ What's New

### Problem Solved:
- âŒ Background (walls, floor) being registered
- âŒ Products far from camera
- âŒ Poor camera quality causing false matches

### Solution:
- âœ… **Interactive crop box** - frame ONLY the product
- âœ… **Live preview** - see exactly what will be registered
- âœ… **Keyboard controls** - precise positioning
- âœ… **Lowered thresholds** - works with poor cameras

---

## ğŸ® How to Use Crop Box

### During Registration:

**You'll see a GREEN BOX on screen**

This box controls what gets registered - ONLY what's inside the box!

### Controls:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MOVEMENT MODE (Default)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  W - Move box UP                â”‚
â”‚  S - Move box DOWN              â”‚
â”‚  A - Move box LEFT              â”‚
â”‚  D - Move box RIGHT             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Press Z to switch to:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RESIZE MODE (Orange box)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  W - Make box SHORTER           â”‚
â”‚  S - Make box TALLER            â”‚
â”‚  A - Make box NARROWER          â”‚
â”‚  D - Make box WIDER             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Press Z again to go back to MOVEMENT MODE
```

---

## ğŸ“‹ Step-by-Step Registration

### 1. Position Your Product

```
Place product in front of camera
(can be far away - crop will zoom in!)
```

### 2. Adjust Crop Box

**GREEN BOX = Movement Mode**
```
Use W/A/S/D to move the box
Position it over your product
```

**ORANGE BOX = Resize Mode (press Z)**
```
Use W/A/S/D to resize the box
Make it fit JUST around the product
```

### 3. Check Preview (Top-Right Corner)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PREVIEW          â”‚
â”‚                  â”‚
â”‚ (zoomed view)    â”‚
â”‚                  â”‚
â”‚ Shows exactly    â”‚
â”‚ what will be     â”‚
â”‚ registered       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Good preview:**
- âœ… Product fills most of the box
- âœ… No wall/floor visible
- âœ… Product is clear

**Bad preview:**
- âŒ Too much background
- âŒ Product too small
- âŒ Product cut off

### 4. Capture

```
When crop box looks good:
Press SPACE
```

---

## ğŸ¨ Visual Guide

### Example: Registering Pringles Can

**Step 1: Initial view**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                 â”‚
â”‚                                 â”‚
â”‚      [Pringles can]             â”‚
â”‚         (far away)              â”‚
â”‚                                 â”‚
â”‚                                 â”‚
â”‚   â”Œâ”€â”€GREEN BOXâ”€â”€â”               â”‚
â”‚   â”‚             â”‚               â”‚
â”‚   â”‚             â”‚               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Box is in center but not on product!
```

**Step 2: Move box (W/A/S/D)**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                 â”‚
â”‚      â”Œâ”€â”€GREEN BOXâ”€â”€â”            â”‚
â”‚      â”‚ [Pringles]  â”‚            â”‚
â”‚      â”‚   can       â”‚            â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                 â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Box positioned over product!
```

**Step 3: Resize (Z then W/A/S/D)**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                 â”‚
â”‚      â”ŒORANGE BOXâ”€â”              â”‚
â”‚      â”‚ Pringles  â”‚              â”‚
â”‚      â”‚   can     â”‚              â”‚
â”‚      â”‚  (fits!)  â”‚              â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Box fits product perfectly!
```

**Step 4: Check preview**
```
Top-right shows:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PRINGLES  â”‚  â† Clear, zoomed
â”‚    CAN     â”‚  â† No background!
â”‚            â”‚  â† Perfect! âœ“
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Step 5: Press SPACE to capture!**

---

## ğŸ”§ Settings for Poor Camera Quality

**Already adjusted in code:**

```python
# More features extracted
nfeatures=2000  (was 1500)

# Lower matching threshold
min_matches=10  (was 15)

# More lenient ratio
match_ratio=0.8  (was 0.75)

# Faster confirmation
stable_threshold=15  (was 20)

# Better noise reduction
GaussianBlur=(7,7)  (was 5,5)

# Contrast enhancement
equalizeHist=True  (new!)
```

**These help with:**
- âœ… Blurry cameras
- âœ… Poor lighting
- âœ… Low resolution
- âœ… Grainy images

---

## ğŸ’¡ Tips for Best Results

### Product Distance

**Too far:**
```
Camera sees: [tiny product] + lots of background
Problem: Too much background noise
```

**Too close:**
```
Camera sees: [product fills screen] but blurry
Problem: Can't see full product
```

**Just right:**
```
Camera sees: [clear product] taking up 50-70% of frame
Solution: Use crop box to zoom in!
```

### Crop Box Strategy

1. **First registration:**
   - Start with default box
   - Move to product
   - Resize to fit SNUGLY
   - Leave small margin (10-20 pixels)

2. **Subsequent registrations:**
   - Box stays at last position
   - Just move to new product
   - Adjust size if needed

### Background Elimination

**Include:**
- âœ… Entire product
- âœ… Product label/text
- âœ… Product edges

**Exclude:**
- âŒ Walls
- âŒ Floor
- âŒ Other objects
- âŒ Your hands (during capture)

---

## ğŸ“Š On-Screen Indicators

### Crop Box Colors

| Color | Mode | Action |
|-------|------|--------|
| **GREEN** | Movement | Move box with W/A/S/D |
| **ORANGE** | Resize | Change size with W/A/S/D |

### Corner Markers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             â”‚  â† Corners show crop area
â”‚   PRODUCT   â”‚
â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Crosshair

```
        â”‚
        â”‚
â”€â”€â”€â”€â”€â”€â”€â”€+â”€â”€â”€â”€â”€â”€â”€â”€  â† Center point
        â”‚
        â”‚
```

Shows exact center of crop box

---

## ğŸ› Troubleshooting

### "Too few features" Error

**Problem:** Less than 20 features detected

**Solutions:**

1. **Adjust crop box:**
   - Include more of the product
   - Make box bigger
   - Ensure product label is visible

2. **Better lighting:**
   - Turn on more lights
   - Avoid shadows
   - Position near window

3. **Move closer:**
   - Bring product closer to camera
   - Or make crop box bigger

4. **Better product:**
   - Use products with text/logos
   - Avoid plain items

### Products Not Detected After Registration

**Problem:** 0/4 detected in waiting mode

**Solutions:**

1. **Same distance:**
   - Keep products at same distance as registration
   - Don't move camera

2. **Same orientation:**
   - Product facing same way
   - Not rotated or upside down

3. **Same lighting:**
   - Lighting conditions match registration
   - No new shadows

4. **Check if registered correctly:**
   - Did you get "âœ… Registered" message?
   - Did it show enough features?

### Still Glitching/Flickering

**If detection is unstable:**

1. **Increase stability threshold:**
   ```python
   # Line 40-41
   self.stable_visible_threshold = 20  # Up from 15
   self.stable_invisible_threshold = 20
   ```

2. **Increase minimum matches:**
   ```python
   # Line 38
   self.min_matches = 15  # Up from 10
   ```

3. **Better feature matching:**
   ```python
   # Line 39
   self.match_ratio = 0.75  # Down from 0.8 (stricter)
   ```

---

## ğŸ¯ Example Session

```bash
$ python cropped_product_tracker.py

# PRODUCT 1 - Pringles

[GREEN box appears in center]

Press D D D (move right to Pringles)
Press S S (move down a bit)
Press Z (switch to resize mode)
[Box turns ORANGE]
Press S S (make taller)
Press A (make narrower)
Press Z (back to move mode)
[Box turns GREEN]

Check preview (top-right): âœ“ Looks good!

Press SPACE

Terminal asks:
  Product name: Pringles
  Price: $4.50
  Quantity: 1

âœ… Registered: Pringles - $4.50 - Qty: 1 - 234 features

# PRODUCT 2 - Coca Cola

[Move box to Coke, adjust, SPACE, enter details]
âœ… Registered: Coca Cola - $2.50 - Qty: 1 - 189 features

# PRODUCT 3 - Doritos

[Move box to Doritos, adjust, SPACE, enter details]
âœ… Registered: Doritos - $3.99 - Qty: 1 - 276 features

# PRODUCT 4 - Sprite

[Move box to Sprite, adjust, SPACE, enter details]
âœ… Registered: Sprite - $2.20 - Qty: 1 - 198 features

âœ… ALL REGISTERED!

# WAITING MODE

Place all products in view...

  Pringles: Searching... 8/15
  Coca Cola: Searching... 5/15
  Doritos: âœ“ DETECTED
  Sprite: Searching... 12/15

[Wait a moment...]

  Pringles: âœ“ DETECTED
  Coca Cola: âœ“ DETECTED
  Doritos: âœ“ DETECTED
  Sprite: âœ“ DETECTED

âœ… TRACKING STARTED!

# TRACKING

[Pick Pringles]
ğŸ›’ PICKED! Pringles
   Price: $4.50
   ğŸ’° Cart Total: $4.50

[Pick Coke]
ğŸ›’ PICKED! Coca Cola
   Price: $2.50
   ğŸ’° Cart Total: $7.00
```

---

## âŒ¨ï¸ All Controls

### Registration Mode

| Key | Action |
|-----|--------|
| **W/A/S/D** | Move or resize crop box |
| **Z** | Toggle Move/Resize mode |
| **SPACE** | Capture product |
| **Q** | Quit |

### Waiting/Tracking Mode

| Key | Action |
|-----|--------|
| **Q** | Quit |
| **R** | Reset cart (tracking only) |

---

## âœ… Why This Fixes Your Issues

### Issue 1: Background Noise
**Before:** Registered whole frame (walls, floor, etc.)  
**Now:** Only register cropped product area âœ“

### Issue 2: Products Far Away
**Before:** Small product + lots of background  
**Now:** Crop box zooms in on product âœ“

### Issue 3: Poor Camera Quality
**Before:** High thresholds, strict matching  
**Now:** Lowered thresholds, lenient matching âœ“

### Issue 4: Glitching Detection
**Before:** Background features causing false matches  
**Now:** Clean product-only registration âœ“

---

## ğŸ‰ This Should Work Much Better!

**Key improvements:**
1. âœ… Crop box eliminates background
2. âœ… Preview shows exact registration
3. âœ… Optimized for poor cameras
4. âœ… Easy keyboard controls

Try it and let me know if the cropping helps!